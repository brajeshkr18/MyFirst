@model T.Model.clsOnCallPeople
@{
    ViewBag.Title = "AddOnCallPeople";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var CanRequest = Model.CanRequest == true ? "checked" : "";
    var CanNotRequest = Model.CanRequest == false ? "checked" : "";
    var IsEmtala = Model.IsEmtala == true ? "checked" : "";
    var NotEmtala = Model.IsEmtala == false ? "checked" : "";
    var Iscredentialed = Model.IsCredentialed == true ? "checked" : "";
    var Notcredentialed = Model.IsCredentialed == false ? "checked" : "";
    string Displayclass = Model.id == 0 ? "display-hide" : "display";
    string attachment = string.IsNullOrEmpty(Model.Picture) == true ? "" : Model.Picture;
}

<div id="dvScrollPosition" class="container">
    <div class="row topmargin-medium">
        <div class="col-md-8 col-md-offset-2">
            <div class="blog-left wow fadeInLeft add-user-form">
                <div class="row">
                    <div class="col-md-12">
                        <div class="blog-two-info">
                         @if (@Model.id != 0)
                        {
                            <h4>Edit OnCall People</h4>
                        }
                        else
                        {
                            <h4>Add OnCall People</h4>
                        }
                            
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="Error alert-Message alert-danger display-hide margin-bottom-0 margin-top-20">
                        <button class="close topx" data-close="alert">x</button>
                        <span id="spnErrorMessage" class="spnErrorMessage"></span>
                    </div>
                    <div class="Success alert-Message alert-success display-hide margin-top-20 margin-bottom-10">
                        <button class="close" data-close="alert">x</button>
                        <span id="spnSuccessMessage" class="spnSuccessMessage"></span>
                    </div>
                </div>
                <div class="row" id="form">
                    <div class="col-md-6">
                        <div class="blog-content">
                            <!-- HTML -->
                            <div class="bs-example">
                                <div role="form">
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">First Name</label>
                                        <input type="text" class="form-control input-md focusedInput" value="@Model.FirstName" id="txtfirstname" placeholder="Enter first name*">
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Last Name</label>
                                        <input type="text" class="form-control input-md focusedInput" value="@Model.LastName" id="txtlastname" placeholder="Enter last name*">
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Phone Number</label>
                                        <input type="text" class="form-control input-md focusedInput" value="@Model.PhoneNumber" id="txtphonenumber" placeholder="XXX-XXX-XXXX">
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Cell Number</label>
                                        <input type="text" class="form-control input-md focusedInput" id="txtcellnumber" value="@Model.CellNo" placeholder="XXX-XXX-XXXX">
                                    </div>
                                    <div class="form-group">
                                        <label for="name">Practice</label>
                                        <select id="ddlPractices" class="form-control">
                                            @if (Model.PracticeId == 0)
                                            {
                                            <option selected="selected" value="0">Select Practice</option>
                                            }
                                            else
                                            {
                                            <option value="0">Select Practice</option>
                                            }

                                            @foreach (var practice in Model.lstPractices)
                                            {
                                            if (practice.id == Model.PracticeId)
                                            {
                                                <option selected="selected" value="@practice.id">@practice.Name</option>
                                            }
                                            else
                                            {
                                                <option value="@practice.id">@practice.Name</option>
                                            }
                                            }

                                        </select>

                                    </div>

                                    <div class="form-group">
                                        <label for="name">Speciality</label>
                                        <select id="ddlSpeciality" class="form-control">
                                            @if (Model.SpecialityId == 0)
                                            {
                                            <option selected="selected" value="0">Select Speciality</option>
                                            }
                                            else
                                            {
                                            <option value="0">Select Speciality</option>
                                            }

                                            @foreach (var speciality in Model.lstSpeciality)
                                            {
                                            if (speciality.id == Model.SpecialityId)
                                            {
                                            <option selected="selected" value="@speciality.id">@speciality.Speciality</option>
                                            }
                                            else
                                            {
                                            <option value="@speciality.id">@speciality.Speciality</option>
                                            }
                                            }

                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Email</label>
                                        <input type="text" class="form-control input-md focusedInput" value="@Model.Email" id="txtemail" placeholder="Enter email*">
                                    </div>

                                </div>
                            </div><!-- /example -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="blog-content">
                            <!-- HTML -->
                            <div class="bs-example">
                                <div role="form">
                                    
                                    <div class="form-group ">
                                        <label for="name">Emtala</label>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <input type="radio" @IsEmtala value="1" id="rbemtalaYes" name="Isemtala" class="rbemtalaYes"> Yes
                                            </div>
                                            <div class="col-md-3">
                                                <input type="radio" @NotEmtala value="0" id="rbemtalaNo" name="Isemtala"> No
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group ">
                                        <label for="name">Can Request</label>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <input type="radio" @CanRequest value="1" id="rbcanrequestYes" name="canrequest" class="rbcanrequestYes"> Yes
                                            </div>
                                            <div class="col-md-3">
                                                <input type="radio" @CanNotRequest value="0" id="rbcanrequestNo" name="canrequest"> No
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group ">
                                        <label for="name">Credentialed</label>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <input type="radio" @Iscredentialed value="1" name="rbCredentialed" id="rbCredentialedYes" class="rbCredentialedYes"> Yes
                                            </div>
                                            <div class="col-md-3">
                                                <input type="radio" @Notcredentialed value="0" name="rbCredentialed" id="rbCredentialedNo"> No
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="name">Mobile Network Providers</label>

                                        <select tabindex="9" id="ddlNetwork" class="form-control">
                                            <option value="0" selected="selected">Select Network Provider</option>
                                            <option value="1" value1="@("@txt.att.net")">AT&T</option>
                                            <option value="2" value1="@("@messaging.sprintpcs.com")">Sprint</option>
                                            <option value="3" value1="@("@tmomail.net")">T-Mobile</option>
                                            <option value="4" value1="@("@vtext.com")">Verizon</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="name">Text Number</label>
                                        <input tabindex="10" type="number" class="form-control input-md focusedInput" id="txtPhnNo" placeholder="Text Number (XXX-XXX-XXXX)">
                                        @*<input tabindex="10" type="number" onkeypress="return isNumberKey(event)"  class="form-control input-md focusedInput" id="txtPhnNo" placeholder="Text Number">*@
                                    </div>
                                    <div class="form-group">
                                        <label for="name">Text Mail Address</label>

                                        <input type="text" name="TextM" disabled="disabled" value="@Model.CallCarrier" class="form-control input-md focusedInput" id="txttextEmail">
                                        <input type="hidden" name="Textmail" />

                                    </div>
                                    <div class="form-group">
                                        <div class="row">
                                            <div class="col-md-6">
                                                    <label for="exampleInputFile">Picture</label>
                                                    <input type="file" id="FileUpload">
                                            </div>
                                            <input type="hidden" id="upld-filepath" value="@attachment" />
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12 display-hide msg-fileupload">
                                                <p id="msgUpload" class="help-block">
                                                    <span class="text-danger spnfailure"></span>
                                                    <span class="text-success spnsuccess"></span>
                                                </p>
                                            </div>
                                        </div>
                                        <div class="row mar-bot-10 dvloader display-hide">
                                            <div class="col-md-1"></div>
                                            <div class="col-md-10">
                                                <img src="~/Assets/img/loader.gif" />
                                            </div>
                                        </div> 
                                        <div class="row padding-top-15">
                                            <div class="col-md-6">
                                                <button id="btn-upload" class="btn btn-primary display-hide">Upload</button>
                                            </div>
                                        </div> 
                                    </div>

                                    <div class="form-group @Displayclass">
                                        <label for="exampleInputFile">Existing Picture</label>
                                        @if (!string.IsNullOrEmpty(attachment))
                                        {
                                            <a target="_blank" href="@attachment">
                                                <p class="text-info">view</p>
                                            </a>
                                        }
                                        else
                                        {
                                          <p class="text-info">No picture</p>
                                        }
                                        
                                    </div>
                                </div>
                            </div><!-- /example -->
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-2 pull-right loader display-hide">
                        <span style="line-height: 20px;"><img src="~/Assets/img/loader.gif" style="margin-bottom:6px" /></span>
                    </div>
                </div>
                <div class="col-md-3 pull-right">
                    <button type="submit" id="submit" class="btn btn-lg btn-submit btn-block">Submit</button>
                </div>
                <div class="col-md-3 pull-right">
                    <a type="submit" id="cancel " class="btn btn-lg btn-submit btn-block" href="@Url.Action("Manage", "Admin")">Cancel</a>
                </div>
            </div>
        </div>

        <!--blog end-->
    </div>
    <input type="hidden" id="hfOnCallId" value="@Model.id" />
    <input type="hidden" id="status-validfile" value="0" />
</div>







<script src="~/assets/js/jquery-1.8.3.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        function alertFunc() {
            $('.Error').removeClass('display').addClass('display-hide')
            $('.Success').removeClass('display').addClass('display-hide')
        }
        $("#submit").click(function () {
            $('.Error').removeClass('display').addClass('display-hide')
            var hasError = false;
            var id = parseInt($('#hfOnCallId').val());
            var firstname = $("#txtfirstname").val();
            var lastname = $("#txtlastname").val();
            var phoneno = $("#txtphonenumber").val();
            var cellno = $("#txtcellnumber").val();
            var email = $("#txtemail").val();
            var practice = $("#ddlPractices").val();
            var speciality = $("#ddlSpeciality").val();
            var iscredentialed = $(".rbCredentialedYes").is(':checked')
            var isemtala = $(".rbemtalaYes").is(':checked')
            var canrequest = $(".rbcanrequestYes").is(':checked')
            var callcarrier = $("#txttextEmail").val();
            var FilePath = $('#upld-filepath').val()
            var Button = $(this)
            $(Button).addClass('disabled')
            $('.loader').removeClass('display-hide').addClass('display')
            $('.Success').removeClass('display').addClass('display-hide')
            if (firstname == "") {
                $('.Error').removeClass('display-hide').addClass('display')
                $('.spnErrorMessage').html('<strong>Error : </strong>Please enter first name.')
                hasError = true;
                $('.loader').removeClass('display').addClass('display-hide')
                $(Button).removeClass('disabled')
            }
            else if (lastname == "") {
                $('.Error').removeClass('display-hide').addClass('display')
                $('.spnErrorMessage').html('<strong>Error : </strong>Please enter last name.')
                hasError = true;
                $('.loader').removeClass('display').addClass('display-hide')
                $(Button).removeClass('disabled')
            }
            else if (phoneno == "") {
                $('.Error').removeClass('display-hide').addClass('display')
                $('.spnErrorMessage').html('<strong>Error : </strong>Please enter phone.')
                $(Button).removeClass('disabled')
                hasError = true;
                $('.loader').removeClass('display').addClass('display-hide')
            }
            else if (!ValidatePhone(phoneno)) {
                $('.Error').removeClass('display-hide').addClass('display')
                $('.spnErrorMessage').html('<strong>Error : </strong> Please enter valid phone number.')
                hasError = true;
                $(Button).removeClass('disabled')
                $('.loader').removeClass('display').addClass('display-hide')
            }
            else if (cellno == "") {
                $('.Error').removeClass('display-hide').addClass('display')
                $('.spnErrorMessage').html('<strong>Error : </strong>Please enter cell number')
                hasError = true;
                $('.loader').removeClass('display').addClass('display-hide')
                $(Button).removeClass('disabled')
            }
            else if (!ValidateOnlyDigits(cellno)) {
                $('.Error').removeClass('display-hide').addClass('display')
                $('.spnErrorMessage').html('<strong>Error : </strong> Please enter valid cell number.')
                hasError = true;
                $('.loader').removeClass('display').addClass('display-hide')
                $(Button).removeClass('disabled')
            }
            else if (speciality == 0) {
                $('.Error').removeClass('display-hide').addClass('display')
                $('.spnErrorMessage').html('<strong>Error : </strong>Please select speciality.')
                hasError = true;
                $('.loader').removeClass('display').addClass('display-hide')
                $(Button).removeClass('disabled')
            }
            else if (email == "") {
                $('.Error').removeClass('display-hide').addClass('display')
                $('.spnErrorMessage').html('<strong>Error : </strong>Please enter email.')
                $(Button).removeClass('disabled')
                hasError = true;
                $('.loader').removeClass('display').addClass('display-hide')
            }
            else if (!ValidateEmail(email)) {
                $('.Error').removeClass('display-hide').addClass('display')
                $('.spnErrorMessage').html('<strong>Error : </strong> Please enter valid email address.')
                hasError = true;
                $('.loader').removeClass('display').addClass('display-hide')
                $(Button).removeClass('disabled')
            }

            if (hasError == false) {
                $('.Error').removeClass('display').addClass('display-hide')
                var url = "/Admin/AddOnCallPeople";
               
                $.post(url, { id: id, FirstName: firstname, LastName: lastname, PhoneNumber: phoneno, CellNo: cellno, Email: email, PracticeId: practice, SpecialityId: speciality, IsEmtala: isemtala, IsCredentialed: iscredentialed, CanRequest: canrequest, CallCarrier: callcarrier, IsActive: true, Picture: FilePath }, function (data) {
                    if ((data.Status) == "Success") {
                        $('.Error').removeClass('display').addClass('display-hide')
                        $('.Success').removeClass('display-hide').addClass('display')
                        $('.spnSuccessMessage').html('<strong>Successful:</strong> ' + data.Message)
                        if (id == 0) {
                            $(':input', '#form').not(':button, :submit, :reset, :hidden').val('').removeAttr('checked').removeAttr('selected');
                        }
                        $('.loader').removeClass('display').addClass('display-hide')
                        $('#FileUpload').val('')
                        $("#btn-upload").removeClass('display').addClass('display-hide');
                        $(Button).removeClass('disabled')
                        setTimeout(alertFunc, 3000);
                    }
                    else if ((data.Status) == "Failure") {
                        $('.Success').removeClass('display').addClass('display-hide')
                        $('.Error').removeClass('display-hide').addClass('display')
                        $('.spnErrorMessage').html('<strong>Error : </strong> ' + data.Message)
                        $('.loader').removeClass('display').addClass('display-hide')
                        $(Button).removeClass('disabled')
                    }
                    else {

                        $('.Error').removeClass('display-hide').addClass('display')
                        $('.spnErrorMessage').html('<strong>Error : </strong>Oops! Something went wrong while processing your request. Please try again')
                        $('.loader').removeClass('display').addClass('display-hide')
                        $(Button).removeClass('disabled')
                    }
                    
                });
            }
            $('html, body').animate({
                'scrollTop': $("#dvScrollPosition").position().top
            }, 600);
        });
        $('#ddlNetwork').change(function () {
            var Text = "";
            $('#form [name=TextM]').val("");
            if ($(this).val() != 0) {
                Text = $('#ddlNetwork :selected').attr('value1');
            }
            if ($('#txtPhnNo').val() != "" && $(this).val() != 0) {
                Text = $('#txtPhnNo').val() + Text
            }
            $('#form [name=TextM]').val(Text);
            $('#form [name=Textmail]').val(Text);
        });
        $('#txtPhnNo').keyup(function () {
            if ($('#ddlNetwork').val() != 0) {
                var PhoneVal = $(this).val()
                var SeletedNetwork = $('#ddlNetwork :selected').attr('value1');
                $('#form [name=TextM]').val(PhoneVal + SeletedNetwork);
                $('#form [name=Textmail]').val(PhoneVal + SeletedNetwork);
            }
        })
    });
    $(document).ready(function () {
        $("#Slider").css("display", "none");
        var CallCarrier = '@Model.CallCarrier'
        if (CallCarrier != "") {
            var arrCallCarrier = CallCarrier.split('@@')
            $('#txtPhnNo').val(arrCallCarrier[0])
            $('#ddlNetwork').find('option').each(function () {
                var Value = $(this).attr('value1')
                if (Value == ('@@' + arrCallCarrier[1])) {
                    $(this).attr('selected', 'selected')
                }

            })
        }
    });

    $('#FileUpload').change(function () {
        var file = this.files[0];
        name = file.name;
        size = file.size;
        type = file.type;
        $('.msg-fileupload').removeClass('display').addClass('display-hide')
        $('.msg-fileupload').find('.spnfailure').html('');
        $('.msg-fileupload').find('.spnsuccess').html('');
        $('#btn-upload').removeClass('display').addClass('display-hide')
        if (file.name.length < 1) {

        }
        else if (file.size > 2500000) {
            $('.msg-fileupload').removeClass('display-hide').addClass('display')
            $('.msg-fileupload').find('.spnfailure').html('The file is too big');
            $('#status-validfile').val('0');
            return;
        }
        else if (file.type != 'image/png' && file.type != 'image/jpg' && file.type != 'image/gif' && file.type != 'image/jpeg') {
            $('.msg-fileupload').removeClass('display-hide').addClass('display')
            $('.msg-fileupload').find('.spnfailure').html('The file does not match png, jpg or gif');
            $('#status-validfile').val('0');
            return;
        }
        $('#btn-upload').removeClass('display-hide').addClass('display')
        $('#status-validfile').val('1');
    })

    $("#btn-upload").click(function () {
        $("#btn-upload").addClass('disabled')
        $('.msg-fileupload').removeClass('display').addClass('display-hide')
        $('.msg-fileupload').find('.spnsuccess').html('');
        $('.msg-fileupload').find('.spnfailure').html('');
        var validstatus = $('#status-validfile').val()
        if (validstatus == "0") {
            $('.msg-fileupload').removeClass('display-hide').addClass('display')
            $('.msg-fileupload').find('.spnfailure').html('Please select images with png, jpg or gif extension only.');
            $("#btn-upload").removeClass('disabled')
            return;
        }
        $('.dvloader').removeClass('display-hide').addClass('display')
        var formData = new FormData();
        var totalFiles = document.getElementById("FileUpload").files.length;
        for (var i = 0; i < totalFiles; i++) {
            var file = document.getElementById("FileUpload").files[i];
            formData.append("FileUpload", file);
        }
        $.ajax({
            type: "POST",
            url: '/Admin/UploadFile',
            data: formData,
            dataType: 'json',
            contentType: false,
            processData: false,
            success: function (response) {
                if (response.Status == "Success") {
                    $('.msg-fileupload').removeClass('display-hide').addClass('display')
                    $('.msg-fileupload').find('.spnsuccess').html(response.Message);
                    $('#upld-filepath').val(response.path);
                    $('.dvloader').removeClass('display').addClass('display-hide')
                    
                } else if (response.Status == "Failure") {
                    $('.msg-fileupload').removeClass('display-hide').addClass('display')
                    $('.msg-fileupload').find('.spnfailure').html(response.Message);
                    $('.dvloader').removeClass('display').addClass('display-hide')
                }
                $("#btn-upload").removeClass('disabled')
            },
            error: function (error) {
                $('.dvloader').removeClass('display').addClass('display-hide')
                $("#btn-upload").removeClass('disabled')
                alert("Oops! Something went wrong while uploading please try again later.");
            }
        });
    });


</script>
<script type="text/javascript">
    $(document).ready(function () {
       
        function isNumberKey(evt) {
            var charCode = (evt.which) ? evt.which : event.keyCode
            if (charCode > 31 && (charCode < 48 || charCode > 57))
                return false;
            return true;
        }
        });
    </script>